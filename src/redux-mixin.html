<!-- redux-mixin.html -->
<link rel="import" href="../bower_components/polymer-redux/polymer-redux.html">
<script src="../node_modules/redux/dist/redux.js"></script>
<script>
    const initialState = {ReferenceList:[], CurrentReference: 0, PageTableList:[], PcbDictionary: {},
        PhysicalFrameList: Array(16)};
    const reducer = (state = initialState, action) => {
        switch(action.type){
            case RESET:
                return initialState;
            case INC_PROCESSPAGEFAULT:
                return {...state, PcbDictionary: {...state.PcbDictionary,
                    [action.payload.Process] : {...state.PcbDictionary[action.payload.Process],
                        pageFaults : state.PcbDictionary[action.payload.Process].pageFaults + 1}}};
            case INC_PROCESSMEMORYREF:
                return {...state, PcbDictionary: {...state.PcbDictionary,
                    [action.payload.Process] : {...state.PcbDictionary[action.payload.Process],
                    memoryReferences: state.PcbDictionary[action.payload.Process].memoryReferences + 1}}};
            case ADD_REFERENCE:
                return {...state, ReferenceList: [...state.ReferenceList, action.payload.row]}
            case INC_REFERENCE:
                return {...state, CurrentReference: state.CurrentReference+1};
            case ADD_PAGETABLE:
                return {...state, PageTableList: [...state.PageTableList, action.payload.PageTable]}
            case ADD_PCB:
                return {...state, PcbDictionary: {...state.PcbDictionary, [action.payload.Pid] : action.payload.Pcb}};
            case INSERT_FRAME:
                return {...state, PhysicalFrameList: [...state.PhysicalFrameList.slice(0,action.payload.PhysicalFrameIndex),
                action.payload.PhysicalFrame,...state.PhysicalFrameList.slice(action.payload.PhysicalFrameIndex+1)]};
            case SET_FRAMEREF:
                return {...state, PhysicalFrameList: state.PhysicalFrameList.map(
                    (frameEntry, i) => i === action.payload.FrameIndex ? {...frameEntry, ref: action.payload.ReferenceValue} : frameEntry
                )};
            case ADD_PAGEENTRY:
                return {...state, PageTableList: state.PageTableList.map(
                    (pageTable, i) => i == action.payload.PageTableIndex
                        ? {...pageTable, entries: [...pageTable.entries, action.payload.PageTableEntry]} : {...pageTable}
                )};
            case REMOVE_PAGEENTRY:
                return {...state, PageTableList: state.PageTableList.map(
                    (pageTable, i) => i == action.payload.PageTableIndex
                        ? {...pageTable, entries: [...pageTable.entries.slice(0, action.payload.PageTableEntry),
                            ...pageTable.entries.slice(action.payload.PageTableEntry+1)]} : {...pageTable}
                )};
            default: return state;
        }
    };
    const store = Redux.createStore(reducer);
    ReduxMixin = PolymerRedux(store); // ReduxMixin has a GLOBAL scope
</script>